<!DOCTYPE html>
<html lang="uk">
{% load static %}
{% load filters %}
<head>
    <meta charset="UTF-8">
    <title>{{ plant.plant_name }}</title>
    <link rel="stylesheet" href="{% static 'content/plant_detail.css' %}">
</head>
<body>
    <header>
        <div class="nav-buttons">
            <a href="{% url 'main_page' %}">–ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
            {% if not user.is_authenticated %}
            <a href="{% url 'login' %}">–£–≤—ñ–π—Ç–∏</a>
            {% endif %}
        </div>
    </header>
    <div class="container">
        <div class="plant-detail">
            {% if user.is_staff %}
            <a href="{% url 'update_plant' plant_id=plant.plant_id %}" id="edit-product-link">
                <img src="{% static 'content/edit_product.png' %}" id="edit-product">
            </a>
            {% endif %}
            <h1>{{ plant.plant_name }}</h1>
            <!-- –§–æ—Ç–æ —Ä–æ—Å–ª–∏–Ω–∏ -->
            {% if plant.photo %}
            <img src="{% static 'plants/' %}{{ plant.photo }}" alt="{{ plant.plant_name }}" class="plant-photo">
            {% else %}
            <img src="{% static 'content/placeholder.jpg' %}" alt="{{ plant.plant_name }}" class="plant-photo">
            {% endif %}

        <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä–æ—Å–ª–∏–Ω—É -->
            <p class="plant-price">{{ plant.price }} –≥—Ä–Ω</p>
            <p class="plant-description">{{ plant.plant_description }}</p>
            <p class="plant-info">
                <strong>–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫:</strong> {{ supplier.supplier_name }}, {{ supplier.country }}
            </p>
            <p class="plant-info">
                <strong>–†—ñ–¥:</strong> {{ genus.genus_name }}
            </p>
            <p class="plant-info">
                <strong>–í–∞–≥–∞:</strong> {{ plant.weight|kilo_to_grams }} –≥ (1 —à—Ç.)
            </p>
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–∏–±–æ—Ä—É –∫—ñ–ª—å–∫–æ—Å—Ç—ñ -->
                <div class="product-control">
                    {% if plant.quantity_in_stock > 0 %}
                        <form class="button-form" action="{% url 'ordering_page' %}" method="GET">
                            <input type="hidden" name="plant_id" value="{{ plant.plant_id }}">
                            <input type="hidden" name="buy_now" value="true">
                            <button class="add-to-cart" type="submit">–ö—É–ø–∏—Ç–∏</button>
                        </form>
                    {% endif %}

                    {% if plant.plant_id in cart_items %}
                    <div class="quantity-control">
                        <form action="{% url 'add_to_cart' plant.plant_id -1 %}" method="POST" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="quantity-btn">-</button>
                        </form>
                        <input type="number" value="{{cart_items|get:plant.plant_id}}" readonly>
                        <form action="{% url 'add_to_cart' plant.plant_id 1 %}" method="POST" style="display: inline;">
                            {% csrf_token %}
                            {% if cart_items|get:plant.plant_id >= plant.quantity_in_stock %}
                                <button type="submit" class="quantity-btn" disabled>+</button>
                            {% else %}
                                <button type="submit" class="quantity-btn">+</button>
                            {% endif %}
                        </form>
                    </div>
                    {% else %}
                        {% if plant.quantity_in_stock > 0 %}
                        <form action="{% url 'add_to_cart' plant.plant_id 1 %}" method="POST" class="button-form">
                            {% csrf_token %}
                            <button type="submit" class="add-to-cart">–î–æ –∫–æ—à–∏–∫–∞</button>
                        </form>
                        {% else %}
                        <form class="disabled-button-form">
                            <button class="add-to-cart" disabled>–¢–æ–≤–∞—Ä—É –Ω–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</button>
                        </form>
                        {% endif %}
                    {% endif %}
                    
                </div>
                <p class="quantity">–£ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ: {{ plant.quantity_in_stock }} —à—Ç.</p>
                {% if plant.additional_info %}
                <a href="{% url 'download_plant_docx' plant.plant_id %}" id="download-plant-docx">
                    üìÑ –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
                </a>
                {% endif %}
        </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –∑–∞–≥–∞–ª—å–Ω–æ—ó –≤–∞—Ä—Ç–æ—Å—Ç—ñ -->
    <script>
        // –û—Ç—Ä–∏–º—É—î–º–æ —Ü—ñ–Ω—É –∑ –∞—Ç—Ä–∏–±—É—Ç–∞ data-price
        const price = parseFloat("{{ plant.price }}".replace(",", "."));  // –ó–∞–º—ñ–Ω—é—î–º–æ –∫–æ–º—É –Ω–∞ –∫—Ä–∞–ø–∫—É –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥—É
        const quantityInput = document.getElementById('quantity');
        const totalPriceElement = document.getElementById('total-price');

        quantityInput.addEventListener('input', function() {
            const quantity = parseFloat(this.value);
            const totalPrice = (price * quantity).toFixed(2);
            totalPriceElement.textContent = totalPrice;
        });
    </script>
</body>
</html>